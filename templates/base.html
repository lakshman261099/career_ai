<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}CareerAI{% endblock %}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  {% block head %}{% endblock %}
  <style>
    * { box-sizing: border-box; }
    html, body { overflow-x: hidden; }
    .glass { background: linear-gradient(135deg, rgba(109,40,217,.6), rgba(168,85,247,.4)); backdrop-filter: blur(8px); }
    .skeleton { position: relative; overflow: hidden; background: #e5e7eb; }
    .skeleton::after { content:""; position:absolute; inset:0; transform: translateX(-100%);
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.5), transparent); animation: shimmer 1.2s infinite;}
    @keyframes shimmer { 100% { transform: translateX(100%);} }
    .locked { position: relative; filter: blur(2px) grayscale(.2); pointer-events:none; }
    .lock-overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(2,6,23,.55); color:#fff; font-weight:600; }
    [data-theme=dark] body { background:#0b1020; color:#e5e7eb; }
    [data-theme=dark] .glass { background: linear-gradient(135deg, rgba(109,40,217,.3), rgba(15,23,42,.6)); }
    input, select, textarea { background:#fff; color:#0f172a; }
    [data-theme=dark] input, [data-theme=dark] select, [data-theme=dark] textarea { background:#0f172a; color:#e5e7eb; border-color:#334155; }
    pre { white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body class="min-h-screen">
  <header class="p-4 flex justify-between items-center">
    <a href="/" class="font-bold text-xl flex items-center gap-2">
      <span>Career<span class="text-purple-500">AI</span></span>
      {% if is_pro() %}
        <span class="text-xs px-2 py-0.5 rounded-full bg-purple-600 text-white">PRO</span>
      {% endif %}
    </a>

    <button id="navToggle" class="md:hidden px-3 py-1 rounded border">â˜°</button>

    <nav id="navItems" class="hidden md:flex gap-3 items-center text-sm">
      <a href="/pricing" class="underline whitespace-nowrap">Pricing</a>
      <a href="/jobpack" class="underline whitespace-nowrap">Job Pack</a>
      <a href="/internships" class="underline whitespace-nowrap">Internships</a>
      <a href="/referral" class="underline whitespace-nowrap">Referrals</a>
      <a href="/portfolio" class="underline whitespace-nowrap">Portfolio</a>
      <a href="/agent" class="underline whitespace-nowrap">Agent</a>

      {% if current_user.is_authenticated %}
        <div class="relative">
          <button id="profBtn" class="px-3 py-1 rounded border whitespace-nowrap">Account â–¾</button>
          <div id="profMenu" class="hidden absolute right-0 mt-2 w-44 bg-white dark:bg-slate-900 border dark:border-slate-700 rounded shadow-lg z-20">
            <a class="block px-3 py-2 hover:bg-slate-50 dark:hover:bg-slate-800" href="/dashboard">Dashboard</a>
            <a class="block px-3 py-2 hover:bg-slate-50 dark:hover:bg-slate-800" href="/settings">Settings</a>
            <a class="block px-3 py-2 hover:bg-slate-50 dark:hover:bg-slate-800" href="/billing/portal">Manage subscription</a>
            <a class="block px-3 py-2 hover:bg-slate-50 dark:hover:bg-slate-800" href="/auth/logout">Logout</a>
          </div>
        </div>
      {% else %}
        <a href="/auth/login" class="px-3 py-1 rounded border whitespace-nowrap">Login</a>
        <a href="/auth/register" class="px-3 py-1 rounded bg-purple-600 text-white whitespace-nowrap">Get started</a>
      {% endif %}
      <button id="themeToggle" class="px-3 py-1 rounded border">ðŸŒ“</button>
    </nav>
  </header>

  <!-- Mobile dropdown -->
  <div id="navMobile" class="hidden md:hidden px-4 pb-3 space-y-2">
    <div class="flex flex-col gap-2 text-sm">
      <a href="/pricing" class="underline">Pricing</a>
      <a href="/jobpack" class="underline">Job Pack</a>
      <a href="/internships" class="underline">Internships</a>
      <a href="/referral" class="underline">Referrals</a>
      <a href="/portfolio" class="underline">Portfolio</a>
      <a href="/agent" class="underline">Agent</a>
      {% if current_user.is_authenticated %}
        <a href="/dashboard" class="underline">Dashboard</a>
        <a href="/settings" class="underline">Settings</a>
        <a href="/billing/portal" class="underline">Manage subscription</a>
        <a href="/auth/logout" class="underline">Logout</a>
      {% else %}
        <a href="/auth/login" class="underline">Login</a>
        <a href="/auth/register" class="underline">Get started</a>
      {% endif %}
      <button id="themeToggleM" class="px-3 py-1 rounded border w-max">ðŸŒ“ Theme</button>
    </div>
  </div>

  <main class="max-w-5xl mx-auto p-4 leading-relaxed">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-4 space-y-2">
          {% for cat,msg in messages %}
            <div class="p-2 rounded {{ 'bg-red-100 text-red-800' if cat=='error' else 'bg-green-100 text-green-800' }}">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <footer class="text-center text-sm text-slate-500 p-8">
    Â© {{ year|default(2025) }} CareerAI â€¢ <a href="/privacy" class="underline">Privacy</a>
  </footer>

  <script>
    (function(){
      const k='careerai-theme';
      const saved=localStorage.getItem(k)||'light';
      document.documentElement.setAttribute('data-theme', saved);

      const toggle=()=>{ 
        const cur=document.documentElement.getAttribute('data-theme'); 
        const next=cur==='light'?'dark':'light'; 
        document.documentElement.setAttribute('data-theme', next); 
        localStorage.setItem(k,next); 
      };

      const btn=document.getElementById('themeToggle');
      const btnM=document.getElementById('themeToggleM');
      if(btn) btn.onclick=toggle;
      if(btnM) btnM.onclick=toggle;

      const pb=document.getElementById('profBtn'), pm=document.getElementById('profMenu');
      if(pb && pm){
        pb.onclick=()=>pm.classList.toggle('hidden');
        window.addEventListener('click', e=>{
          if(!pb.contains(e.target) && !pm.contains(e.target)) pm.classList.add('hidden');
        });
      }

      const navToggle=document.getElementById('navToggle');
      const navMobile=document.getElementById('navMobile');
      if(navToggle) navToggle.onclick=()=>navMobile.classList.toggle('hidden');
    })();

    {% if not is_pro() %}
    document.addEventListener("DOMContentLoaded", function() {
      document.querySelectorAll('[data-lock="pro"]').forEach(el=>{
        el.classList.add('locked');
        const overlay=document.createElement('div');
        overlay.className='lock-overlay';
        overlay.innerHTML='<div class="text-center"><div class="text-lg mb-2">Pro Feature</div><a class="px-3 py-1 rounded bg-purple-600 text-white" href="/pricing">Unlock Pro</a></div>';
        el.appendChild(overlay);
      });
    });
    {% endif %}
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
