{% extends "base.html" %}
{% block title %}Portfolio – CareerAI{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold mb-3">Portfolio Builder</h1>

{% if is_free %}
  <div class="border rounded p-4 mb-4">
    <p class="text-sm">On Free, you can get <b>one curated project idea</b> based on your resume to help you plan your portfolio. Publishing a public page requires Pro.</p>
  </div>
  <form method="post" action="/portfolio/idea" class="glass rounded p-4 space-y-3">
    <div>
      <label class="block text-sm mb-1">Resume (paste text)</label>
      <textarea name="resume_text" rows="7" class="w-full border p-2 rounded" placeholder="Paste your resume text…"></textarea>
    </div>
    <button class="px-4 py-2 bg-purple-600 text-white rounded">Get a project idea</button>
  </form>

  {% if suggestions %}
    <div class="mt-4">
      <h2 class="font-semibold mb-2">Your project idea</h2>
      {% for s in suggestions %}
        <div class="border rounded p-4">
          <div class="font-semibold">{{ s.title }}</div>
          <p class="text-sm text-slate-600">{{ s.summary }}</p>
          <div class="text-sm mt-2"><b>Why:</b> {{ s.why }}</div>
          <div class="text-sm mt-2"><b>How:</b>
            <ul class="list-disc pl-5">
              {% for step in s.how %}<li>{{ step }}</li>{% endfor %}
            </ul>
          </div>
          <div class="text-sm mt-2"><b>Tips:</b> {{ s.tips|join(', ') }}</div>
        </div>
      {% endfor %}
      <div class="mt-3">
        <a class="px-4 py-2 border rounded" href="/pricing">Upgrade to Pro to publish a portfolio</a>
      </div>
    </div>
  {% endif %}
{% else %}
  <div class="border rounded p-4 mb-4">
    <p class="text-sm">Pro: Fill your details, then <b>Scan</b> to get 3 project options. Choose to include one, or publish without a project.</p>
  </div>
  <form method="post" action="/portfolio/scan" class="glass rounded p-4 space-y-3">
    <div>
      <label class="block text-sm mb-1">Title</label>
      <input name="title" class="w-full border p-2 rounded" value="{{ (page.title if page else '') }}" placeholder="Your Name – Portfolio" />
    </div>

    <div class="grid md:grid-cols-2 gap-3">
      <div>
        <label class="block text-sm mb-1">About Me (HTML ok)</label>
        <textarea name="about_html" rows="6" class="w-full border p-2 rounded" placeholder="<p>Hi, I build …</p>">{{ page.about_html if page else '' }}</textarea>
      </div>
      <div>
        <label class="block text-sm mb-1">Resume (paste text or leave blank to import last saved)</label>
        <textarea name="resume_text" rows="6" class="w-full border p-2 rounded" placeholder="Paste resume text (optional)"></textarea>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-3">
      <div>
        <label class="block text-sm mb-1">Skills (comma-separated)</label>
        <input name="skills_csv" class="w-full border p-2 rounded" value="{{ page.skills_csv if page else '' }}" placeholder="Python, SQL, React, Experimentation" />
      </div>
      <div>
        <label class="block text-sm mb-1">Links</label>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
          <input name="github" class="w-full border p-2 rounded" placeholder="GitHub URL" />
          <input name="linkedin" class="w-full border p-2 rounded" placeholder="LinkedIn URL" />
          <input name="website" class="w-full border p-2 rounded" placeholder="Website URL" />
        </div>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-3">
      <div>
        <label class="block text-sm mb-1">Experience (HTML ok)</label>
        <textarea name="experience_html" rows="6" class="w-full border p-2 rounded" placeholder="<ul><li>Company – Impact</li></ul>">{{ page.experience_html if page else '' }}</textarea>
      </div>
      <div>
        <label class="block text-sm mb-1">Education (HTML ok)</label>
        <textarea name="education_html" rows="6" class="w-full border p-2 rounded" placeholder="<ul><li>University – Major</li></ul>">{{ page.education_html if page else '' }}</textarea>
      </div>
    </div>

    <button class="px-4 py-2 bg-purple-600 text-white rounded">Scan & suggest 3 projects</button>
  </form>

  {% if suggestions %}
    <form method="post" action="/portfolio/save" class="border rounded p-4 mt-4 space-y-3">
      <p class="text-sm">Select a project to include in your portfolio (optional). If you select none, we’ll publish without a project.</p>
      <div class="grid md:grid-cols-3 gap-3">
        {% for s in suggestions %}
          <label class="block border rounded p-3 cursor-pointer">
            <div class="font-semibold">{{ s.title }}</div>
            <p class="text-sm text-slate-600">{{ s.summary }}</p>
            <div class="text-xs mt-1"><b>Why:</b> {{ s.why }}</div>
            <ul class="list-disc pl-5 text-xs mt-1">
              {% for step in s.how %}<li>{{ step }}</li>{% endfor %}
            </ul>
            <div class="mt-2">
              <input type="radio" name="include_project_title" value="{{ s.title }}" /> Include this
            </div>
          </label>
        {% endfor %}
      </div>

      <!-- Re-submit the fields so /save has them -->
      <input type="hidden" name="title" value="{{ request.form.get('title') }}">
      <input type="hidden" name="about_html" value="{{ request.form.get('about_html') }}">
      <input type="hidden" name="resume_text" value="{{ request.form.get('resume_text') }}">
      <input type="hidden" name="skills_csv" value="{{ request.form.get('skills_csv') }}">
      <input type="hidden" name="github" value="{{ request.form.get('github') }}">
      <input type="hidden" name="linkedin" value="{{ request.form.get('linkedin') }}">
      <input type="hidden" name="website" value="{{ request.form.get('website') }}">
      <input type="hidden" name="experience_html" value="{{ request.form.get('experience_html') }}">
      <input type="hidden" name="education_html" value="{{ request.form.get('education_html') }}">

      <div class="flex gap-2">
        <button class="px-4 py-2 bg-purple-600 text-white rounded">Publish portfolio</button>
        <a class="px-4 py-2 border rounded" target="_blank" href="/portfolio/view/{{ (page.slug if page else 'preview') }}">Preview</a>
      </div>
    </form>
  {% endif %}
{% endif %}
{% endblock %}
