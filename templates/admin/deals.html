{# templates/admin/deals.html #}
{% extends "admin/_layout.html" %}

{% block title %}Admin · Deals · CareerAI{% endblock %}
{% set active_tab = 'deals' %}

{% block admin_body %}
<div>

  <h1 class="text-xl sm:text-2xl font-semibold tracking-tight mb-4">
    Admin · University Deals
  </h1>

  {% if not current_user.is_super_admin and not current_user.is_ultra_admin %}
    <p class="text-[12px] text-amber-300/80 mb-4">
      You do not have permission to view or modify university deals.
    </p>
  {% else %}

  <div class="grid gap-6 lg:grid-cols-2 mb-6 text-[13px]">

    <!-- Create deal -->
    <div class="glass-card rounded-2xl px-4 py-4">
      <h2 class="text-sm font-semibold mb-3">Create a new deal</h2>

      {% if not universities %}
        <p class="text-[11px] text-slate-400/80">
          No universities exist yet. Create one first.
        </p>
      {% else %}
        <form method="post" class="space-y-3">

          <!-- University -->
          <div>
            <label class="block text-xs font-semibold mb-1 text-slate-200/90">
              University
            </label>
            <select name="university_id" required
              class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-400">
              <option value="">Select university…</option>
              {% for uni in universities %}
                <option value="{{ uni.id }}">
                  {{ uni.name }}{% if uni.tenant_slug %} · {{ uni.tenant_slug }}{% endif %}
                </option>
              {% endfor %}
            </select>
          </div>

          <!-- Deal name -->
          <div>
            <label class="block text-xs font-semibold mb-1 text-slate-200/90">
              Deal name
            </label>
            <input
              type="text"
              name="name"
              required
              placeholder="Veltech 2025 pack, BITS 1-year pilot, …"
              class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-400"
            />
          </div>

          <!-- Seats & credits -->
          <div class="grid gap-3 sm:grid-cols-3">
            <div>
              <label class="block text-xs font-semibold mb-1 text-slate-200/90">
                Seats
              </label>
              <input
                type="number"
                name="seats_total"
                min="1"
                placeholder="200"
                class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm"
              />
            </div>

            <div>
              <label class="block text-xs font-semibold mb-1 text-slate-200/90">
                Silver total
              </label>
              <input
                type="number"
                name="silver_credits_total"
                min="0"
                placeholder="50000"
                class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm"
              />
            </div>

            <div>
              <label class="block text-xs font-semibold mb-1 text-slate-200/90">
                Gold total
              </label>
              <input
                type="number"
                name="gold_credits_total"
                min="0"
                placeholder="20000"
                class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm"
              />
            </div>
          </div>

          <!-- Pricing + status -->
          <div class="grid gap-3 sm:grid-cols-3">
            <div>
              <label class="block text-xs font-semibold mb-1 text-slate-200/90">
                Price (cents)
              </label>
              <input
                type="number"
                name="price_cents"
                min="0"
                placeholder="2500000"
                class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm"
              />
            </div>

            <div>
              <label class="block text-xs font-semibold mb-1 text-slate-200/90">
                Currency
              </label>
              <input
                type="text"
                name="currency_code"
                value="INR"
                class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm"
              />
            </div>

            <div>
              <label class="block text-xs font-semibold mb-1 text-slate-200/90">
                Status
              </label>
              <select
                name="status"
                class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm"
              >
                <option value="draft">Draft</option>
                <option value="active" selected>Active</option>
                <option value="paused">Paused</option>
                <option value="closed">Closed</option>
              </select>
            </div>
          </div>

          <!-- Dates -->
          <div class="grid gap-3 sm:grid-cols-2">
            <div>
              <label class="block text-xs font-semibold mb-1 text-slate-200/90">
                Start date
              </label>
              <input
                type="date"
                name="start_date"
                class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm"
              />
            </div>

            <div>
              <label class="block text-xs font-semibold mb-1 text-slate-200/90">
                End date
              </label>
              <input
                type="date"
                name="end_date"
                class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm"
              />
            </div>
          </div>

          <!-- Notes -->
          <div>
            <label class="block text-xs font-semibold mb-1 text-slate-200/90">
              Notes
            </label>
            <textarea
              name="notes"
              rows="3"
              placeholder="Invoice notes, contract terms, internal references…"
              class="w-full rounded-lg border border-slate-600/70 bg-slate-950/70 px-3 py-2 text-sm"
            ></textarea>
          </div>

          <button type="submit" class="btn-primary text-xs mt-1">
            Create deal
          </button>

        </form>
      {% endif %}
    </div>

    <!-- Existing deals -->
    <div class="glass-card rounded-2xl px-4 py-4 text-[12px]">
      <h2 class="text-sm font-semibold mb-3">Existing deals</h2>

      {% if deals %}
        <div class="overflow-x-auto text-[11px]">
          <table class="min-w-full">
            <thead class="bg-slate-900/80 text-slate-200/80">
              <tr>
                <th class="px-3 py-2 text-left font-semibold">University</th>
                <th class="px-3 py-2 text-left font-semibold">Deal</th>
                <th class="px-3 py-2 text-left font-semibold">Seats</th>
                <th class="px-3 py-2 text-left font-semibold">Silver</th>
                <th class="px-3 py-2 text-left font-semibold">Gold</th>
                <th class="px-3 py-2 text-left font-semibold">Status</th>
              </tr>
            </thead>

            <tbody>
              {% for d in deals %}
              <tr class="border-t border-slate-700/60">

                <!-- University -->
                <td class="px-3 py-2 text-slate-100/90">
                  {{ d.university.name if d.university else "—" }}
                </td>

                <!-- Deal name -->
                <td class="px-3 py-2">
                  <div class="text-slate-100/90 font-semibold">{{ d.name }}</div>
                  {% if d.start_date or d.end_date %}
                    <div class="text-[10px] text-slate-400/80">
                      {{ d.start_date or '—' }} → {{ d.end_date or '—' }}
                    </div>
                  {% endif %}
                </td>

                <!-- Seats -->
                <td class="px-3 py-2 text-slate-200/80">
                  {% if d.seats_total is not none %}
                    {{ d.seats_used or 0 }} / {{ d.seats_total }}
                  {% else %}
                    —
                  {% endif %}
                </td>

                <!-- Silver credits -->
                <td class="px-3 py-2 text-slate-200/80">
                  {% if d.silver_credits_total is not none %}
                    {{ d.silver_credits_used or 0 }} / {{ d.silver_credits_total }}
                  {% else %}
                    —
                  {% endif %}
                </td>

                <!-- Gold credits -->
                <td class="px-3 py-2 text-slate-200/80">
                  {% if d.gold_credits_total is not none %}
                    {{ d.gold_credits_used or 0 }} / {{ d.gold_credits_total }}
                  {% else %}
                    —
                  {% endif %}
                </td>

                <!-- Status badge -->
                <td class="px-3 py-2 text-slate-200/90">
                  <span class="inline-flex items-center px-2 py-0.5 rounded-full border text-[10px]
                    {% if d.status == 'active' %}
                      border-emerald-400/50 bg-emerald-500/10 text-emerald-200
                    {% elif d.status == 'paused' %}
                      border-amber-400/50 bg-amber-500/10 text-amber-200
                    {% elif d.status == 'closed' %}
                      border-red-400/50 bg-red-500/10 text-red-200
                    {% else %}
                      border-slate-500/50 bg-slate-800/40 text-slate-200
                    {% endif %}
                  ">
                    {{ d.status|capitalize }}
                  </span>
                </td>

              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-[11px] text-slate-400/80">
          No deals have been created yet.
        </p>
      {% endif %}
    </div>

  </div>

  {% endif %}

</div>
{% endblock %}
