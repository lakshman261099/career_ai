{# templates/admin/vouchers.html #}
{% extends "base.html" %}
{% block title %}Admin ¬∑ Vouchers ¬∑ CareerAI{% endblock %}

{% block content %}
<div class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 mt-6 mb-16">

  {# ---------- Shared Admin Sub-Nav ---------- #}
  {% macro admin_tab(label, endpoint_name, extra_endpoints) %}
    {% set ep = request.endpoint or '' %}
    {% set active = (ep == endpoint_name) or (ep in extra_endpoints) %}
    <a href="{{ url_for(endpoint_name) }}"
       class="px-3 py-1.5 rounded-full border text-xs
              {% if active %}
                bg-slate-900 text-white border-indigo-400
              {% else %}
                bg-slate-900/40 text-slate-200/80 border-slate-500/70 hover:border-indigo-400/80
              {% endif %}">
      {{ label }}
    </a>
  {% endmacro %}

  <div class="glass-card rounded-2xl px-4 py-3 mb-5 flex flex-wrap items-center gap-2 text-[12px]">
    {{ admin_tab("Overview", "admin.dashboard", []) }}
    {{ admin_tab("Users", "admin.users", []) }}
    {{ admin_tab("Credits", "admin.credits", []) }}
    {{ admin_tab("Universities", "admin.universities", []) }}
    {{ admin_tab("Deals", "admin.deals", []) }}
    {{ admin_tab("Vouchers", "admin.vouchers", ["admin.voucher_detail"]) }}

    <span class="ml-auto text-[11px] text-slate-400/80">
      Admin ¬∑ vouchers & promo codes
    </span>
  </div>

  <h1 class="text-xl sm:text-2xl font-semibold tracking-tight mb-4">
    Admin ¬∑ Vouchers & Promo Codes
  </h1>

  <div class="grid gap-5 lg:grid-cols-2 mb-6 text-[13px]">
    <div class="glass-card rounded-2xl px-4 py-4">
      <h2 class="text-sm font-semibold mb-3">Create voucher campaign</h2>

      <form method="post" class="space-y-3">
        <div>
          <label class="block text-xs font-semibold mb-1 text-slate-200/90">
            Code
          </label>
          <input type="text" name="code" required placeholder="VELTECH50, LAKSHMAN20, CAMPUS2025‚Ä¶"
                 class="w-full rounded-lg border border-slate-500/70 bg-slate-950/60 px-3 py-2 text-sm uppercase focus:outline-none focus:ring-1 focus:ring-indigo-400"/>
        </div>

        <div>
          <label class="block text-xs font-semibold mb-1 text-slate-200/90">
            Description
          </label>
          <input type="text" name="description"
                 class="w-full rounded-lg border border-slate-500/70 bg-slate-950/60 px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-400"
                 placeholder="Influencer code, campus event, special offer, ‚Ä¶"/>
        </div>

        <div class="grid gap-3 sm:grid-cols-3">
          <div>
            <label class="block text-xs font-semibold mb-1 text-slate-200/90">
              Discount %
            </label>
            <input type="number" name="discount_percent" min="0" max="100" placeholder="e.g. 50"
                   class="w-full rounded-lg border border-slate-500/70 bg-slate-950/60 px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-400"/>
          </div>
          <div>
            <label class="block text-xs font-semibold mb-1 text-slate-200/90">
              Bonus Silver ü™ô
            </label>
            <input type="number" name="bonus_silver" min="0" value="0"
                   class="w-full rounded-lg border border-slate-500/70 bg-slate-950/60 px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-400"/>
          </div>
          <div>
            <label class="block text-xs font-semibold mb-1 text-slate-200/90">
              Bonus Gold ‚≠ê
            </label>
            <input type="number" name="bonus_gold" min="0" value="0"
                   class="w-full rounded-lg border border-slate-500/70 bg-slate-950/60 px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-400"/>
          </div>
        </div>

        <div class="grid gap-3 sm:grid-cols-3">
          <div class="sm:col-span-2">
            <label class="block text-xs font-semibold mb-1 text-slate-200/90">
              Limit to university (optional)
            </label>
            <select name="university_id"
                    class="w-full rounded-lg border border-slate-500/70 bg-slate-950/60 px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-400">
              <option value="">Global (any tenant)</option>
              {% for uni in universities %}
                <option value="{{ uni.id }}">{{ uni.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label class="block text-xs font-semibold mb-1 text-slate-200/90">
              Max uses
            </label>
            <input type="number" name="max_uses" min="1" placeholder="e.g. 100"
                   class="w-full rounded-lg border border-slate-500/70 bg-slate-950/60 px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-400"/>
          </div>
        </div>

        <div>
          <label class="block text-xs font-semibold mb-1 text-slate-200/90">
            Expires at (optional)
          </label>
          <input type="date" name="expires_at"
                 class="w-full rounded-lg border border-slate-500/70 bg-slate-950/60 px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-400"/>
        </div>

        <button type="submit" class="btn-primary text-xs mt-1">
          Create voucher campaign
        </button>
      </form>
    </div>

    <div class="glass-card rounded-2xl px-4 py-4 text-[12px]">
      <h2 class="text-sm font-semibold mb-3">Voucher campaigns</h2>
      {% if vouchers %}
        <div class="overflow-x-auto -mx-2">
          <table class="min-w-full text-[11px]">
            <thead class="bg-slate-900/80 text-slate-200/80">
              <tr>
                <th class="px-3 py-2 text-left font-semibold">Code</th>
                <th class="px-3 py-2 text-left font-semibold">Offer</th>
                <th class="px-3 py-2 text-left font-semibold">Scope</th>
                <th class="px-3 py-2 text-left font-semibold">Usage</th>
                <th class="px-3 py-2 text-left font-semibold">Status</th>
              </tr>
            </thead>
            <tbody>
              {% for v in vouchers %}
              <tr class="border-t border-slate-700/60">
                <td class="px-3 py-2 text-slate-100/90">
                  <a href="{{ url_for('admin.voucher_detail', campaign_id=v.id) }}"
                     class="underline decoration-slate-400/80 hover:decoration-indigo-400">
                    {{ v.code }}
                  </a>
                  <div class="text-slate-400/80 text-[10px]">
                    {{ v.description or '‚Äî' }}
                  </div>
                </td>
                <td class="px-3 py-2 text-slate-200/80">
                  {% if v.discount_percent %}
                    {{ v.discount_percent }}% off
                  {% endif %}
                  {% if v.bonus_silver %}
                    {% if v.discount_percent %} + {% endif %}
                    +{{ v.bonus_silver }} ü™ô
                  {% endif %}
                  {% if v.bonus_gold %}
                    {% if v.discount_percent or v.bonus_silver %} + {% endif %}
                    +{{ v.bonus_gold }} ‚≠ê
                  {% endif %}
                  {% if not (v.discount_percent or v.bonus_silver or v.bonus_gold) %}
                    ‚Äî
                  {% endif %}
                </td>
                <td class="px-3 py-2 text-slate-200/80">
                  {% if v.university %}
                    {{ v.university.name }}
                  {% else %}
                    Global
                  {% endif %}
                </td>
                <td class="px-3 py-2 text-slate-200/80">
                  {% if v.max_uses %}
                    {{ v.used_count or 0 }} / {{ v.max_uses }}
                  {% else %}
                    {{ v.used_count or 0 }} used
                  {% endif %}
                </td>
                <td class="px-3 py-2 text-slate-200/80">
                  {% if not v.is_active %}
                    Inactive
                  {% elif v.expires_at and v.expires_at < now %}
                    Expired
                  {% else %}
                    Active
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-[11px] text-slate-400/80">
          No voucher campaigns yet. Create one to start giving promo codes to partners, influencers or universities.
        </p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
