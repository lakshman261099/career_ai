{# templates/admin/voucher_detail.html #}
{% extends "base.html" %}
{% block title %}Admin ¬∑ Voucher {{ campaign.code }} ¬∑ CareerAI{% endblock %}

{% block content %}
<div class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 mt-6 mb-16">

  {# ---------- Shared Admin Sub-Nav ---------- #}
  {% macro admin_tab(label, endpoint_name, extra_endpoints) %}
    {% set ep = request.endpoint or '' %}
    {% set active = (ep == endpoint_name) or (ep in extra_endpoints) %}
    <a href="{{ url_for(endpoint_name) }}"
       class="px-3 py-1.5 rounded-full border text-xs
              {% if active %}
                bg-slate-900 text-white border-indigo-400
              {% else %}
                bg-slate-900/40 text-slate-200/80 border-slate-500/70 hover:border-indigo-400/80
              {% endif %}">
      {{ label }}
    </a>
  {% endmacro %}

  <div class="glass-card rounded-2xl px-4 py-3 mb-5 flex flex-wrap items-center gap-2 text-[12px]">
    {{ admin_tab("Overview", "admin.dashboard", []) }}
    {{ admin_tab("Users", "admin.users", []) }}
    {{ admin_tab("Credits", "admin.credits", []) }}
    {{ admin_tab("Universities", "admin.universities", []) }}
    {{ admin_tab("Deals", "admin.deals", []) }}
    {{ admin_tab("Vouchers", "admin.vouchers", ["admin.voucher_detail"]) }}

    <span class="ml-auto text-[11px] text-slate-400/80">
      Admin ¬∑ voucher detail
    </span>
  </div>

  <h1 class="text-xl sm:text-2xl font-semibold tracking-tight mb-4">
    Voucher ¬∑ {{ campaign.code }}
  </h1>

  <div class="glass-card rounded-2xl px-4 py-4 mb-6 text-[12px]">
    <div class="flex flex-wrap gap-4 justify-between">
      <div>
        <div class="text-sm font-semibold mb-1">{{ campaign.code }}</div>
        <div class="text-slate-300/80 mb-1">
          {{ campaign.description or "No description" }}
        </div>
        <div class="text-[11px] text-slate-400/80">
          Scope:
          {% if campaign.university %}
            {{ campaign.university.name }}
          {% else %}
            Global
          {% endif %}
        </div>
      </div>
      <div>
        <div class="uppercase text-[10px] tracking-widest text-slate-300/70 mb-1">
          Offer
        </div>
        <div class="text-[11px] text-slate-100/90">
          {% if campaign.discount_percent %}
            {{ campaign.discount_percent }}% off
          {% endif %}
          {% if campaign.bonus_silver %}
            {% if campaign.discount_percent %} + {% endif %}
            +{{ campaign.bonus_silver }} ü™ô
          {% endif %}
          {% if campaign.bonus_gold %}
            {% if campaign.discount_percent or campaign.bonus_silver %} + {% endif %}
            +{{ campaign.bonus_gold }} ‚≠ê
          {% endif %}
          {% if not (campaign.discount_percent or campaign.bonus_silver or campaign.bonus_gold) %}
            ‚Äî
          {% endif %}
        </div>
        <div class="mt-1 text-[11px] text-slate-400/80">
          Uses: {{ campaign.used_count or 0 }}
          {% if campaign.max_uses %}/ {{ campaign.max_uses }}{% endif %}
        </div>
      </div>
      <div>
        <div class="uppercase text-[10px] tracking-widest text-slate-300/70 mb-1">
          Status
        </div>
        <div class="text-[11px] text-slate-100/90">
          {% if not campaign.is_active %}
            Inactive
          {% elif campaign.expires_at and campaign.expires_at < now %}
            Expired
          {% else %}
            Active
          {% endif %}
        </div>
        {% if campaign.expires_at %}
          <div class="mt-1 text-[11px] text-slate-400/80">
            Expires {{ campaign.expires_at.strftime('%Y-%m-%d') }}
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="glass-card rounded-2xl px-4 py-4 text-[12px]">
    <h2 class="text-sm font-semibold mb-3">Redemptions</h2>
    {% if redemptions %}
      <div class="overflow-x-auto -mx-2">
        <table class="min-w-full text-[11px]">
          <thead class="bg-slate-900/80 text-slate-200/80">
            <tr>
              <th class="px-3 py-2 text-left font-semibold">When</th>
              <th class="px-3 py-2 text-left font-semibold">User</th>
              <th class="px-3 py-2 text-left font-semibold">University</th>
              <th class="px-3 py-2 text-left font-semibold">Context</th>
            </tr>
          </thead>
          <tbody>
            {% for r in redemptions %}
            <tr class="border-t border-slate-700/60">
              <td class="px-3 py-2 text-slate-200/80">
                {{ r.redeemed_at.strftime('%Y-%m-%d %H:%M') if r.redeemed_at else '' }}
              </td>
              <td class="px-3 py-2 text-slate-100/90">
                {{ r.user.email if r.user else '‚Äî' }}
              </td>
              <td class="px-3 py-2 text-slate-200/80">
                {% if r.user and r.user.university %}
                  {{ r.user.university.name }}
                {% else %}
                  ‚Äî
                {% endif %}
              </td>
              <td class="px-3 py-2 text-slate-200/80">
                {{ r.context or '‚Äî' }}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-[11px] text-slate-400/80">
        This voucher has not been used yet.
      </p>
    {% endif %}
  </div>
</div>
{% endblock %}
