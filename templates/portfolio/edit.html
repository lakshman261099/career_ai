{% extends "base.html" %}
{% block title %}Edit Draft — CareerAI{% endblock %}
{% block content %}
<section class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 pt-12 grid lg:grid-cols-3 gap-6">
  <!-- Editor -->
  <div class="glass-panel rounded-2xl p-6 lg:col-span-2">
    <div class="flex items-start justify-between">
      <h1 class="text-xl font-bold">Edit Draft</h1>
      <div class="flex items-center gap-2">
        {% if page.is_public %}
          <a href="{{ url_for('portfolio.view', page_id=page.id) }}" target="_blank" rel="noopener" class="btn-ghost">Public link →</a>
        {% endif %}
        <a href="{{ url_for('portfolio.index') }}" class="btn-ghost">Back</a>
      </div>
    </div>

    <p class="text-xs text-white/60 mb-4">Edits may count toward your daily limit.</p>

    <form method="POST">
      <label class="block text-sm mb-1">Title</label>
      <input name="title" value="{{ page.title }}" class="w-full rounded-xl px-3 py-2 bg-white/10 border border-white/20">

      <label class="block text-sm mt-4 mb-1">Content (Markdown)</label>
      <textarea name="content_md" rows="16" class="w-full rounded-xl px-3 py-2 bg-white/10 border border-white/20">{{ page.content_md }}</textarea>

      <div class="mt-4 flex gap-2 items-center">
        <button class="btn-primary" type="submit">Update Draft</button>
        {% if not page.is_public %}
          <form method="POST" action="{{ url_for('portfolio.publish', page_id=page.id) }}" onsubmit="return confirmPublish()">
            <input type="hidden" name="confirm_publish" id="confirm_publish_input" value="no">
            <button class="btn-ghost" type="submit">Publish ⭐</button>
          </form>
          <span class="text-xs text-white/60">Publishing consumes Pro ⭐ credits and locks the page.</span>
        {% else %}
          <form method="POST" action="{{ url_for('portfolio.unpublish', page_id=page.id) }}">
            <button class="btn-ghost" type="submit">Unpublish</button>
          </form>
        {% endif %}
      </div>
    </form>
  </div>

  <!-- Suggestions (Pro) -->
  <aside class="glass-panel rounded-2xl p-6">
    <h2 class="text-sm font-semibold uppercase tracking-wider text-white/70">Project Suggestions</h2>
    <p class="text-xs text-white/60 mt-1">Pick one &amp; tailor your content.</p>
    <div class="mt-3 space-y-3">
      {% for s in suggestions %}
        <div class="rounded-xl border border-white/10 p-3">
          <div class="font-semibold">{{ s.title }}</div>
          <div class="text-xs text-white/70 mt-1"><span class="text-white/60">Why:</span> {{ s.why }}</div>
          <div class="mt-2 text-xs"><span class="text-white/60">Tech:</span> {{ s.tech|join(', ') }}</div>
          <details class="mt-2 text-xs text-white/80">
            <summary class="cursor-pointer text-white/60">Steps</summary>
            <ul class="list-disc pl-5 mt-1 space-y-1">
              {% for step in s.steps %}<li>{{ step }}</li>{% endfor %}
            </ul>
          </details>
        </div>
      {% endfor %}
    </div>
  </aside>
</section>

<script>
function confirmPublish() {
  const ok = window.confirm(
    "Final check:\n\n• Is your title & content complete?\n• This will consume ⭐ credits\n• Published pages are locked (no edits)\n\nPublish now?"
  );
  document.getElementById("confirm_publish_input").value = ok ? "yes" : "no";
  return ok;
}
</script>
{% endblock %}
